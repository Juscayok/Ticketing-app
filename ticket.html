<!DOCTYPE html>
<html>
<head>
    <title>Ticket #{{ ticket.id }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>
<body>
  <h1>Ticket #{{ ticket.id }}</h1>
  <p><strong>Submitted By:</strong> {{ ticket.submitted_by }}</p>
  <p><strong>Category:</strong> {{ ticket.category }}</p>
  <p><strong>Description:</strong> {{ ticket.description }}</p>
  <p><strong>Priority:</strong> {{ ticket.priority }}</p>
  <p><strong>Status:</strong> {{ ticket.status }}</p>
  <p><strong>Date:</strong> {{ ticket.date }}</p>
  <p><strong>Last Updated:</strong> {{ ticket.last_updated }}</p>
  <p><strong>Resolution Notes:</strong> {{ ticket.resolution_notes }}</p>

  <h2>Work Logs</h2>
  <div class="work-logs">
    {% if ticket.work_logs %}
      {% for log in ticket.work_logs %}
        <div class="work-log-entry">
          <p><strong>{{ log.date }}</strong> by {{ log.logged_by }}</p>
          <p>{{ log.entry }}</p>
          <hr>
        </div>
      {% endfor %}
    {% else %}
      <p>No work logs yet.</p>
    {% endif %}
  </div>

  {% if session.logged_in %}
  <form method="POST" action="/ticket/{{ ticket.id }}/add_work_log">
    <h3>Add Work Log Entry</h3>
    <textarea name="work_log_entry" rows="4" style="width: 100%;" required placeholder="Enter your work log entry here..."></textarea>
    <button type="submit">Add Work Log</button>
  </form>
  {% endif %}

  <h2>Update Ticket</h2>
  <form method="POST" action="/ticket/{{ ticket.id }}/update">
    Status:
    <select name="status">
      <option {% if ticket.status == 'Open' %}selected{% endif %}>Open</option>
      <option {% if ticket.status == 'Closed' %}selected{% endif %}>Closed</option>
      <option {% if ticket.status == 'Canceled' %}selected{% endif %}>Canceled</option>
    </select><br>
    Resolution Notes: <textarea name="notes">{{ ticket.resolution_notes }}</textarea><br>
    <button type="submit">Update Ticket</button>
  </form>
  
  {% if session.logged_in %}
  <form method="POST" action="/ticket/{{ ticket.id }}/delete" style="display: inline;">
    <button type="submit" onclick="return confirm('Are you sure you want to delete this ticket?')">Delete Ticket</button>
  </form>
  {% endif %}
  <a href="/">Back to Dashboard</a>
</body>
</html>